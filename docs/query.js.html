<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>query.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">leancloud-storage</a> <span class='package-version'>v4.15.3</span></h2><h3>Classes</h3><ul><li><a href="AV.ACL.html">ACL</a><ul class='methods'><li data-type='method'><a href="AV.ACL.html#getPublicReadAccess">getPublicReadAccess</a></li><li data-type='method'><a href="AV.ACL.html#getPublicWriteAccess">getPublicWriteAccess</a></li><li data-type='method'><a href="AV.ACL.html#getReadAccess">getReadAccess</a></li><li data-type='method'><a href="AV.ACL.html#getRoleReadAccess">getRoleReadAccess</a></li><li data-type='method'><a href="AV.ACL.html#getRoleWriteAccess">getRoleWriteAccess</a></li><li data-type='method'><a href="AV.ACL.html#getWriteAccess">getWriteAccess</a></li><li data-type='method'><a href="AV.ACL.html#setPublicReadAccess">setPublicReadAccess</a></li><li data-type='method'><a href="AV.ACL.html#setPublicWriteAccess">setPublicWriteAccess</a></li><li data-type='method'><a href="AV.ACL.html#setReadAccess">setReadAccess</a></li><li data-type='method'><a href="AV.ACL.html#setRoleReadAccess">setRoleReadAccess</a></li><li data-type='method'><a href="AV.ACL.html#setRoleWriteAccess">setRoleWriteAccess</a></li><li data-type='method'><a href="AV.ACL.html#setWriteAccess">setWriteAccess</a></li><li data-type='method'><a href="AV.ACL.html#toJSON">toJSON</a></li></ul></li><li><a href="AV.Captcha.html">Captcha</a><ul class='methods'><li data-type='method'><a href="AV.Captcha.html#.request">request</a></li><li data-type='method'><a href="AV.Captcha.html#bind">bind</a></li><li data-type='method'><a href="AV.Captcha.html#refresh">refresh</a></li><li data-type='method'><a href="AV.Captcha.html#unbind">unbind</a></li><li data-type='method'><a href="AV.Captcha.html#verify">verify</a></li></ul></li><li><a href="AV.Conversation.html">Conversation</a><ul class='methods'><li data-type='method'><a href="AV.Conversation.html#addMember">addMember</a></li><li data-type='method'><a href="AV.Conversation.html#broadcast">broadcast</a></li><li data-type='method'><a href="AV.Conversation.html#getCreator">getCreator</a></li><li data-type='method'><a href="AV.Conversation.html#getLastMessageAt">getLastMessageAt</a></li><li data-type='method'><a href="AV.Conversation.html#getMembers">getMembers</a></li><li data-type='method'><a href="AV.Conversation.html#getMutedMembers">getMutedMembers</a></li><li data-type='method'><a href="AV.Conversation.html#getName">getName</a></li><li data-type='method'><a href="AV.Conversation.html#isSystem">isSystem</a></li><li data-type='method'><a href="AV.Conversation.html#isTransient">isTransient</a></li><li data-type='method'><a href="AV.Conversation.html#send">send</a></li></ul></li><li><a href="AV.Error.html">Error</a></li><li><a href="AV.File.html">File</a><ul class='methods'><li data-type='method'><a href="AV.File.html#.censor">censor</a></li><li data-type='method'><a href="AV.File.html#.createWithoutData">createWithoutData</a></li><li data-type='method'><a href="AV.File.html#.withURL">withURL</a></li><li data-type='method'><a href="AV.File.html#censor">censor</a></li><li data-type='method'><a href="AV.File.html#destroy">destroy</a></li><li data-type='method'><a href="AV.File.html#fetch">fetch</a></li><li data-type='method'><a href="AV.File.html#get">get</a></li><li data-type='method'><a href="AV.File.html#getACL">getACL</a></li><li data-type='method'><a href="AV.File.html#metaData">metaData</a></li><li data-type='method'><a href="AV.File.html#name">name</a></li><li data-type='method'><a href="AV.File.html#ownerId">ownerId</a></li><li data-type='method'><a href="AV.File.html#save">save</a></li><li data-type='method'><a href="AV.File.html#set">set</a></li><li data-type='method'><a href="AV.File.html#setACL">setACL</a></li><li data-type='method'><a href="AV.File.html#setUploadHeader">setUploadHeader</a></li><li data-type='method'><a href="AV.File.html#size">size</a></li><li data-type='method'><a href="AV.File.html#thumbnailURL">thumbnailURL</a></li><li data-type='method'><a href="AV.File.html#toFullJSON">toFullJSON</a></li><li data-type='method'><a href="AV.File.html#toJSON">toJSON</a></li><li data-type='method'><a href="AV.File.html#url">url</a></li></ul></li><li><a href="AV.Friendship.html">Friendship</a><ul class='methods'><li data-type='method'><a href="AV.Friendship.html#.acceptRequest">acceptRequest</a></li><li data-type='method'><a href="AV.Friendship.html#.declineRequest">declineRequest</a></li><li data-type='method'><a href="AV.Friendship.html#.request">request</a></li></ul></li><li><a href="AV.GeoPoint.html">GeoPoint</a><ul class='methods'><li data-type='method'><a href="AV.GeoPoint.html#.current">current</a></li><li data-type='method'><a href="AV.GeoPoint.html#kilometersTo">kilometersTo</a></li><li data-type='method'><a href="AV.GeoPoint.html#milesTo">milesTo</a></li><li data-type='method'><a href="AV.GeoPoint.html#radiansTo">radiansTo</a></li><li data-type='method'><a href="AV.GeoPoint.html#toJSON">toJSON</a></li></ul></li><li><a href="AV.InboxQuery.html">InboxQuery</a><ul class='methods'><li data-type='method'><a href="AV.InboxQuery.html#inboxType">inboxType</a></li><li data-type='method'><a href="AV.InboxQuery.html#maxId">maxId</a></li><li data-type='method'><a href="AV.InboxQuery.html#owner">owner</a></li><li data-type='method'><a href="AV.InboxQuery.html#sinceId">sinceId</a></li></ul></li><li><a href="AV.Insight.JobQuery.html">JobQuery</a><ul class='methods'><li data-type='method'><a href="AV.Insight.JobQuery.html#find">find</a></li><li data-type='method'><a href="AV.Insight.JobQuery.html#limit">limit</a></li><li data-type='method'><a href="AV.Insight.JobQuery.html#skip">skip</a></li></ul></li><li><a href="AV.Leaderboard.html">Leaderboard</a><ul class='methods'><li data-type='method'><a href="AV.Leaderboard.html#.createLeaderboard">createLeaderboard</a></li><li data-type='method'><a href="AV.Leaderboard.html#.createWithoutData">createWithoutData</a></li><li data-type='method'><a href="AV.Leaderboard.html#.deleteStatistics">deleteStatistics</a></li><li data-type='method'><a href="AV.Leaderboard.html#.getLeaderboard">getLeaderboard</a></li><li data-type='method'><a href="AV.Leaderboard.html#.getStatistics">getStatistics</a></li><li data-type='method'><a href="AV.Leaderboard.html#.updateStatistics">updateStatistics</a></li><li data-type='method'><a href="AV.Leaderboard.html#count">count</a></li><li data-type='method'><a href="AV.Leaderboard.html#destroy">destroy</a></li><li data-type='method'><a href="AV.Leaderboard.html#fetch">fetch</a></li><li data-type='method'><a href="AV.Leaderboard.html#getArchives">getArchives</a></li><li data-type='method'><a href="AV.Leaderboard.html#getResults">getResults</a></li><li data-type='method'><a href="AV.Leaderboard.html#getResultsAroundUser">getResultsAroundUser</a></li><li data-type='method'><a href="AV.Leaderboard.html#reset">reset</a></li><li data-type='method'><a href="AV.Leaderboard.html#updateUpdateStrategy">updateUpdateStrategy</a></li><li data-type='method'><a href="AV.Leaderboard.html#updateVersionChangeInterval">updateVersionChangeInterval</a></li></ul></li><li><a href="AV.LiveQuery.html">LiveQuery</a><ul class='methods'><li data-type='method'><a href="AV.LiveQuery.html#.pause">pause</a></li><li data-type='method'><a href="AV.LiveQuery.html#.resume">resume</a></li><li data-type='method'><a href="AV.LiveQuery.html#unsubscribe">unsubscribe</a></li></ul></li><li><a href="AV.Object.html">Object</a><ul class='methods'><li data-type='method'><a href="AV.Object.html#.'new'">'new'</a></li><li data-type='method'><a href="AV.Object.html#.createWithoutData">createWithoutData</a></li><li data-type='method'><a href="AV.Object.html#.destroyAll">destroyAll</a></li><li data-type='method'><a href="AV.Object.html#.extend">extend</a></li><li data-type='method'><a href="AV.Object.html#.fetchAll">fetchAll</a></li><li data-type='method'><a href="AV.Object.html#.register">register</a></li><li data-type='method'><a href="AV.Object.html#.saveAll">saveAll</a></li><li data-type='method'><a href="AV.Object.html#add">add</a></li><li data-type='method'><a href="AV.Object.html#addUnique">addUnique</a></li><li data-type='method'><a href="AV.Object.html#bitAnd">bitAnd</a></li><li data-type='method'><a href="AV.Object.html#bitOr">bitOr</a></li><li data-type='method'><a href="AV.Object.html#bitXor">bitXor</a></li><li data-type='method'><a href="AV.Object.html#change">change</a></li><li data-type='method'><a href="AV.Object.html#clear">clear</a></li><li data-type='method'><a href="AV.Object.html#clone">clone</a></li><li data-type='method'><a href="AV.Object.html#destroy">destroy</a></li><li data-type='method'><a href="AV.Object.html#dirty">dirty</a></li><li data-type='method'><a href="AV.Object.html#dirtyKeys">dirtyKeys</a></li><li data-type='method'><a href="AV.Object.html#escape">escape</a></li><li data-type='method'><a href="AV.Object.html#fetch">fetch</a></li><li data-type='method'><a href="AV.Object.html#fetchWhenSave">fetchWhenSave</a></li><li data-type='method'><a href="AV.Object.html#get">get</a></li><li data-type='method'><a href="AV.Object.html#getACL">getACL</a></li><li data-type='method'><a href="AV.Object.html#getCreatedAt">getCreatedAt</a></li><li data-type='method'><a href="AV.Object.html#getObjectId">getObjectId</a></li><li data-type='method'><a href="AV.Object.html#getUpdatedAt">getUpdatedAt</a></li><li data-type='method'><a href="AV.Object.html#has">has</a></li><li data-type='method'><a href="AV.Object.html#increment">increment</a></li><li data-type='method'><a href="AV.Object.html#initialize">initialize</a></li><li data-type='method'><a href="AV.Object.html#isNew">isNew</a></li><li data-type='method'><a href="AV.Object.html#isValid">isValid</a></li><li data-type='method'><a href="AV.Object.html#op">op</a></li><li data-type='method'><a href="AV.Object.html#previous">previous</a></li><li data-type='method'><a href="AV.Object.html#previousAttributes">previousAttributes</a></li><li data-type='method'><a href="AV.Object.html#relation">relation</a></li><li data-type='method'><a href="AV.Object.html#remove">remove</a></li><li data-type='method'><a href="AV.Object.html#revert">revert</a></li><li data-type='method'><a href="AV.Object.html#save">save</a></li><li data-type='method'><a href="AV.Object.html#set">set</a></li><li data-type='method'><a href="AV.Object.html#setACL">setACL</a></li><li data-type='method'><a href="AV.Object.html#toFullJSON">toFullJSON</a></li><li data-type='method'><a href="AV.Object.html#toJSON">toJSON</a></li><li data-type='method'><a href="AV.Object.html#unset">unset</a></li><li data-type='method'><a href="AV.Object.html#validate">validate</a></li></ul></li><li><a href="AV.Query.html">Query</a><ul class='methods'><li data-type='method'><a href="AV.Query.html#.and">and</a></li><li data-type='method'><a href="AV.Query.html#.doCloudQuery">doCloudQuery</a></li><li data-type='method'><a href="AV.Query.html#.fromJSON">fromJSON</a></li><li data-type='method'><a href="AV.Query.html#.or">or</a></li><li data-type='method'><a href="AV.Query.html#addAscending">addAscending</a></li><li data-type='method'><a href="AV.Query.html#addDescending">addDescending</a></li><li data-type='method'><a href="AV.Query.html#ascending">ascending</a></li><li data-type='method'><a href="AV.Query.html#containedIn">containedIn</a></li><li data-type='method'><a href="AV.Query.html#contains">contains</a></li><li data-type='method'><a href="AV.Query.html#containsAll">containsAll</a></li><li data-type='method'><a href="AV.Query.html#count">count</a></li><li data-type='method'><a href="AV.Query.html#descending">descending</a></li><li data-type='method'><a href="AV.Query.html#destroyAll">destroyAll</a></li><li data-type='method'><a href="AV.Query.html#doesNotExist">doesNotExist</a></li><li data-type='method'><a href="AV.Query.html#doesNotMatchKeyInQuery">doesNotMatchKeyInQuery</a></li><li data-type='method'><a href="AV.Query.html#doesNotMatchQuery">doesNotMatchQuery</a></li><li data-type='method'><a href="AV.Query.html#each">each</a></li><li data-type='method'><a href="AV.Query.html#endsWith">endsWith</a></li><li data-type='method'><a href="AV.Query.html#equalTo">equalTo</a></li><li data-type='method'><a href="AV.Query.html#exists">exists</a></li><li data-type='method'><a href="AV.Query.html#find">find</a></li><li data-type='method'><a href="AV.Query.html#findAndCount">findAndCount</a></li><li data-type='method'><a href="AV.Query.html#first">first</a></li><li data-type='method'><a href="AV.Query.html#get">get</a></li><li data-type='method'><a href="AV.Query.html#greaterThan">greaterThan</a></li><li data-type='method'><a href="AV.Query.html#greaterThanOrEqualTo">greaterThanOrEqualTo</a></li><li data-type='method'><a href="AV.Query.html#include">include</a></li><li data-type='method'><a href="AV.Query.html#includeACL">includeACL</a></li><li data-type='method'><a href="AV.Query.html#lessThan">lessThan</a></li><li data-type='method'><a href="AV.Query.html#lessThanOrEqualTo">lessThanOrEqualTo</a></li><li data-type='method'><a href="AV.Query.html#limit">limit</a></li><li data-type='method'><a href="AV.Query.html#matches">matches</a></li><li data-type='method'><a href="AV.Query.html#matchesKeyInQuery">matchesKeyInQuery</a></li><li data-type='method'><a href="AV.Query.html#matchesQuery">matchesQuery</a></li><li data-type='method'><a href="AV.Query.html#near">near</a></li><li data-type='method'><a href="AV.Query.html#notContainedIn">notContainedIn</a></li><li data-type='method'><a href="AV.Query.html#notEqualTo">notEqualTo</a></li><li data-type='method'><a href="AV.Query.html#scan">scan</a></li><li data-type='method'><a href="AV.Query.html#select">select</a></li><li data-type='method'><a href="AV.Query.html#sizeEqualTo">sizeEqualTo</a></li><li data-type='method'><a href="AV.Query.html#skip">skip</a></li><li data-type='method'><a href="AV.Query.html#startsWith">startsWith</a></li><li data-type='method'><a href="AV.Query.html#subscribe">subscribe</a></li><li data-type='method'><a href="AV.Query.html#toJSON">toJSON</a></li><li data-type='method'><a href="AV.Query.html#withinGeoBox">withinGeoBox</a></li><li data-type='method'><a href="AV.Query.html#withinKilometers">withinKilometers</a></li><li data-type='method'><a href="AV.Query.html#withinMiles">withinMiles</a></li><li data-type='method'><a href="AV.Query.html#withinRadians">withinRadians</a></li></ul></li><li><a href="AV.Relation.html">Relation</a><ul class='methods'><li data-type='method'><a href="AV.Relation.html#.reverseQuery">reverseQuery</a></li><li data-type='method'><a href="AV.Relation.html#add">add</a></li><li data-type='method'><a href="AV.Relation.html#query">query</a></li><li data-type='method'><a href="AV.Relation.html#remove">remove</a></li><li data-type='method'><a href="AV.Relation.html#toJSON">toJSON</a></li></ul></li><li><a href="AV.Role.html">Role</a><ul class='methods'><li data-type='method'><a href="AV.Role.html#getName">getName</a></li><li data-type='method'><a href="AV.Role.html#getRoles">getRoles</a></li><li data-type='method'><a href="AV.Role.html#getUsers">getUsers</a></li><li data-type='method'><a href="AV.Role.html#setName">setName</a></li></ul></li><li><a href="AV.SearchQuery.html">SearchQuery</a><ul class='methods'><li data-type='method'><a href="AV.SearchQuery.html#addAscending">addAscending</a></li><li data-type='method'><a href="AV.SearchQuery.html#addDescending">addDescending</a></li><li data-type='method'><a href="AV.SearchQuery.html#ascending">ascending</a></li><li data-type='method'><a href="AV.SearchQuery.html#descending">descending</a></li><li data-type='method'><a href="AV.SearchQuery.html#find">find</a></li><li data-type='method'><a href="AV.SearchQuery.html#hasMore">hasMore</a></li><li data-type='method'><a href="AV.SearchQuery.html#highlights">highlights</a></li><li data-type='method'><a href="AV.SearchQuery.html#hits">hits</a></li><li data-type='method'><a href="AV.SearchQuery.html#include">include</a></li><li data-type='method'><a href="AV.SearchQuery.html#limit">limit</a></li><li data-type='method'><a href="AV.SearchQuery.html#queryString">queryString</a></li><li data-type='method'><a href="AV.SearchQuery.html#reset">reset</a></li><li data-type='method'><a href="AV.SearchQuery.html#sid">sid</a></li><li data-type='method'><a href="AV.SearchQuery.html#skip">skip</a></li><li data-type='method'><a href="AV.SearchQuery.html#sortBy">sortBy</a></li></ul></li><li><a href="AV.SearchSortBuilder.html">SearchSortBuilder</a><ul class='methods'><li data-type='method'><a href="AV.SearchSortBuilder.html#ascending">ascending</a></li><li data-type='method'><a href="AV.SearchSortBuilder.html#build">build</a></li><li data-type='method'><a href="AV.SearchSortBuilder.html#descending">descending</a></li><li data-type='method'><a href="AV.SearchSortBuilder.html#whereNear">whereNear</a></li></ul></li><li><a href="AV.Status.html">Status</a><ul class='methods'><li data-type='method'><a href="AV.Status.html#.countUnreadStatuses">countUnreadStatuses</a></li><li data-type='method'><a href="AV.Status.html#.inboxQuery">inboxQuery</a></li><li data-type='method'><a href="AV.Status.html#.resetUnreadCount">resetUnreadCount</a></li><li data-type='method'><a href="AV.Status.html#.sendPrivateStatus">sendPrivateStatus</a></li><li data-type='method'><a href="AV.Status.html#.sendStatusToFollowers">sendStatusToFollowers</a></li><li data-type='method'><a href="AV.Status.html#.statusQuery">statusQuery</a></li><li data-type='method'><a href="AV.Status.html#destroy">destroy</a></li><li data-type='method'><a href="AV.Status.html#get">get</a></li><li data-type='method'><a href="AV.Status.html#send">send</a></li><li data-type='method'><a href="AV.Status.html#set">set</a></li><li data-type='method'><a href="AV.Status.html#toObject">toObject</a></li></ul></li><li><a href="AV.User.html">User</a><ul class='methods'><li data-type='method'><a href="AV.User.html#._genId">_genId</a></li><li data-type='method'><a href="AV.User.html#.become">become</a></li><li data-type='method'><a href="AV.User.html#.changePhoneNumber">changePhoneNumber</a></li><li data-type='method'><a href="AV.User.html#.current">current</a></li><li data-type='method'><a href="AV.User.html#.currentAsync">currentAsync</a></li><li data-type='method'><a href="AV.User.html#.followeeQuery">followeeQuery</a></li><li data-type='method'><a href="AV.User.html#.followerQuery">followerQuery</a></li><li data-type='method'><a href="AV.User.html#.logIn">logIn</a></li><li data-type='method'><a href="AV.User.html#.loginAnonymously">loginAnonymously</a></li><li data-type='method'><a href="AV.User.html#.loginWithAuthData">loginWithAuthData</a></li><li data-type='method'><a href="AV.User.html#.loginWithAuthDataAndUnionId">loginWithAuthDataAndUnionId</a></li><li data-type='method'><a href="AV.User.html#.loginWithEmail">loginWithEmail</a></li><li data-type='method'><a href="AV.User.html#.loginWithMiniApp">loginWithMiniApp</a></li><li data-type='method'><a href="AV.User.html#.logInWithMobilePhone">logInWithMobilePhone</a></li><li data-type='method'><a href="AV.User.html#.logInWithMobilePhoneSmsCode">logInWithMobilePhoneSmsCode</a></li><li data-type='method'><a href="AV.User.html#.loginWithQQApp">loginWithQQApp</a></li><li data-type='method'><a href="AV.User.html#.loginWithQQAppWithUnionId">loginWithQQAppWithUnionId</a></li><li data-type='method'><a href="AV.User.html#.loginWithWeapp">loginWithWeapp</a></li><li data-type='method'><a href="AV.User.html#.loginWithWeappWithUnionId">loginWithWeappWithUnionId</a></li><li data-type='method'><a href="AV.User.html#.logOut">logOut</a></li><li data-type='method'><a href="AV.User.html#.mergeUnionId">mergeUnionId</a></li><li data-type='method'><a href="AV.User.html#.requestChangePhoneNumber">requestChangePhoneNumber</a></li><li data-type='method'><a href="AV.User.html#.requestEmailVerify">requestEmailVerify</a></li><li data-type='method'><a href="AV.User.html#.requestLoginSmsCode">requestLoginSmsCode</a></li><li data-type='method'><a href="AV.User.html#.requestMobilePhoneVerify">requestMobilePhoneVerify</a></li><li data-type='method'><a href="AV.User.html#.requestPasswordReset">requestPasswordReset</a></li><li data-type='method'><a href="AV.User.html#.requestPasswordResetBySmsCode">requestPasswordResetBySmsCode</a></li><li data-type='method'><a href="AV.User.html#.resetPasswordBySmsCode">resetPasswordBySmsCode</a></li><li data-type='method'><a href="AV.User.html#.signUp">signUp</a></li><li data-type='method'><a href="AV.User.html#.signUpOrlogInWithAuthData">signUpOrlogInWithAuthData</a></li><li data-type='method'><a href="AV.User.html#.signUpOrlogInWithAuthDataAndUnionId">signUpOrlogInWithAuthDataAndUnionId</a></li><li data-type='method'><a href="AV.User.html#.signUpOrlogInWithMobilePhone">signUpOrlogInWithMobilePhone</a></li><li data-type='method'><a href="AV.User.html#.verifyMobilePhone">verifyMobilePhone</a></li><li data-type='method'><a href="AV.User.html#associateWithAuthData">associateWithAuthData</a></li><li data-type='method'><a href="AV.User.html#associateWithAuthDataAndUnionId">associateWithAuthDataAndUnionId</a></li><li data-type='method'><a href="AV.User.html#associateWithMiniApp">associateWithMiniApp</a></li><li data-type='method'><a href="AV.User.html#associateWithQQApp">associateWithQQApp</a></li><li data-type='method'><a href="AV.User.html#associateWithQQAppWithUnionId">associateWithQQAppWithUnionId</a></li><li data-type='method'><a href="AV.User.html#associateWithWeapp">associateWithWeapp</a></li><li data-type='method'><a href="AV.User.html#associateWithWeappWithUnionId">associateWithWeappWithUnionId</a></li><li data-type='method'><a href="AV.User.html#authenticated">authenticated</a></li><li data-type='method'><a href="AV.User.html#dissociateAuthData">dissociateAuthData</a></li><li data-type='method'><a href="AV.User.html#fetch">fetch</a></li><li data-type='method'><a href="AV.User.html#follow">follow</a></li><li data-type='method'><a href="AV.User.html#followeeQuery">followeeQuery</a></li><li data-type='method'><a href="AV.User.html#followerQuery">followerQuery</a></li><li data-type='method'><a href="AV.User.html#getEmail">getEmail</a></li><li data-type='method'><a href="AV.User.html#getFollowersAndFollowees">getFollowersAndFollowees</a></li><li data-type='method'><a href="AV.User.html#getMobilePhoneNumber">getMobilePhoneNumber</a></li><li data-type='method'><a href="AV.User.html#getRoles">getRoles</a></li><li data-type='method'><a href="AV.User.html#getSessionToken">getSessionToken</a></li><li data-type='method'><a href="AV.User.html#getUsername">getUsername</a></li><li data-type='method'><a href="AV.User.html#isAnonymous">isAnonymous</a></li><li data-type='method'><a href="AV.User.html#isAuthenticated">isAuthenticated</a></li><li data-type='method'><a href="AV.User.html#isCurrent">isCurrent</a></li><li data-type='method'><a href="AV.User.html#linkWithWeapp">linkWithWeapp</a></li><li data-type='method'><a href="AV.User.html#logIn">logIn</a></li><li data-type='method'><a href="AV.User.html#loginWithAuthData">loginWithAuthData</a></li><li data-type='method'><a href="AV.User.html#loginWithAuthDataAndUnionId">loginWithAuthDataAndUnionId</a></li><li data-type='method'><a href="AV.User.html#loginWithMiniApp">loginWithMiniApp</a></li><li data-type='method'><a href="AV.User.html#loginWithQQApp">loginWithQQApp</a></li><li data-type='method'><a href="AV.User.html#loginWithQQAppWithUnionId">loginWithQQAppWithUnionId</a></li><li data-type='method'><a href="AV.User.html#loginWithWeapp">loginWithWeapp</a></li><li data-type='method'><a href="AV.User.html#loginWithWeappWithUnionId">loginWithWeappWithUnionId</a></li><li data-type='method'><a href="AV.User.html#refreshSessionToken">refreshSessionToken</a></li><li data-type='method'><a href="AV.User.html#save">save</a></li><li data-type='method'><a href="AV.User.html#setEmail">setEmail</a></li><li data-type='method'><a href="AV.User.html#setMobilePhoneNumber">setMobilePhoneNumber</a></li><li data-type='method'><a href="AV.User.html#setPassword">setPassword</a></li><li data-type='method'><a href="AV.User.html#setUsername">setUsername</a></li><li data-type='method'><a href="AV.User.html#signUp">signUp</a></li><li data-type='method'><a href="AV.User.html#signUpOrlogInWithMobilePhone">signUpOrlogInWithMobilePhone</a></li><li data-type='method'><a href="AV.User.html#unfollow">unfollow</a></li><li data-type='method'><a href="AV.User.html#updatePassword">updatePassword</a></li></ul></li><li><a href="Statistic.html">Statistic</a></li></ul><h3>Events</h3><ul><li><a href="AV.LiveQuery.html#Events">AV.LiveQuery</a><ul class='events'><a href="AV.LiveQuery.html#event:create">create</a><a href="AV.LiveQuery.html#event:delete">delete</a><a href="AV.LiveQuery.html#event:enter">enter</a><a href="AV.LiveQuery.html#event:leave">leave</a><a href="AV.LiveQuery.html#event:update">update</a></ul></li></ul><h3>Namespaces</h3><ul><li><a href="AV.html">AV</a><ul class='methods'><li data-type='method'><a href="AV.html#.init">init</a></li><li data-type='method'><a href="AV.html#.parse">parse</a></li><li data-type='method'><a href="AV.html#.parseJSON">parseJSON</a></li><li data-type='method'><a href="AV.html#.request">request</a></li><li data-type='method'><a href="AV.html#.setAdapters">setAdapters</a></li><li data-type='method'><a href="AV.html#.setProduction">setProduction</a></li><li data-type='method'><a href="AV.html#.setRequestTimeout">setRequestTimeout</a></li><li data-type='method'><a href="AV.html#.setServerURL">setServerURL</a></li><li data-type='method'><a href="AV.html#.stringify">stringify</a></li></ul></li><li><a href="AV.Cloud.html">Cloud</a><ul class='methods'><li data-type='method'><a href="AV.Cloud.html#.getServerDate">getServerDate</a></li><li data-type='method'><a href="AV.Cloud.html#.requestCaptcha">requestCaptcha</a></li><li data-type='method'><a href="AV.Cloud.html#.requestSmsCode">requestSmsCode</a></li><li data-type='method'><a href="AV.Cloud.html#.rpc">rpc</a></li><li data-type='method'><a href="AV.Cloud.html#.run">run</a></li><li data-type='method'><a href="AV.Cloud.html#.useMasterKey">useMasterKey</a></li><li data-type='method'><a href="AV.Cloud.html#.verifyCaptcha">verifyCaptcha</a></li><li data-type='method'><a href="AV.Cloud.html#.verifySmsCode">verifySmsCode</a></li></ul></li><li><a href="AV.debug.html">debug</a><ul class='methods'><li data-type='method'><a href="AV.debug.html#.enable">enable</a></li></ul></li><li><a href="AV.Insight.html">Insight</a><ul class='methods'><li data-type='method'><a href="AV.Insight.html#.on">on</a></li><li data-type='method'><a href="AV.Insight.html#.startJob">startJob</a></li></ul></li><li><a href="AV.Push.html">Push</a><ul class='methods'><li data-type='method'><a href="AV.Push.html#.send">send</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">query.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const _ = require('underscore');
const debug = require('debug')('leancloud:query');
const AVError = require('./error');
const { _request, request } = require('./request');
const {
  ensureArray,
  transformFetchOptions,
  continueWhile,
} = require('./utils');

const requires = (value, message) => {
  if (value === undefined) {
    throw new Error(message);
  }
};

// AV.Query is a way to create a list of AV.Objects.
module.exports = function(AV) {
  /**
   * Creates a new AV.Query for the given AV.Object subclass.
   * @param {Class|String} objectClass An instance of a subclass of AV.Object, or a AV className string.
   * @class
   *
   * &lt;p>AV.Query defines a query that is used to fetch AV.Objects. The
   * most common use case is finding all objects that match a query through the
   * &lt;code>find&lt;/code> method. For example, this sample code fetches all objects
   * of class &lt;code>MyClass&lt;/code>. It calls a different function depending on
   * whether the fetch succeeded or not.
   *
   * &lt;pre>
   * var query = new AV.Query(MyClass);
   * query.find().then(function(results) {
   *   // results is an array of AV.Object.
   * }, function(error) {
   *   // error is an instance of AVError.
   * });&lt;/pre>&lt;/p>
   *
   * &lt;p>An AV.Query can also be used to retrieve a single object whose id is
   * known, through the get method. For example, this sample code fetches an
   * object of class &lt;code>MyClass&lt;/code> and id &lt;code>myId&lt;/code>. It calls a
   * different function depending on whether the fetch succeeded or not.
   *
   * &lt;pre>
   * var query = new AV.Query(MyClass);
   * query.get(myId).then(function(object) {
   *   // object is an instance of AV.Object.
   * }, function(error) {
   *   // error is an instance of AVError.
   * });&lt;/pre>&lt;/p>
   *
   * &lt;p>An AV.Query can also be used to count the number of objects that match
   * the query without retrieving all of those objects. For example, this
   * sample code counts the number of objects of the class &lt;code>MyClass&lt;/code>
   * &lt;pre>
   * var query = new AV.Query(MyClass);
   * query.count().then(function(number) {
   *   // There are number instances of MyClass.
   * }, function(error) {
   *   // error is an instance of AVError.
   * });&lt;/pre>&lt;/p>
   */
  AV.Query = function(objectClass) {
    if (_.isString(objectClass)) {
      objectClass = AV.Object._getSubclass(objectClass);
    }

    this.objectClass = objectClass;

    this.className = objectClass.prototype.className;

    this._where = {};
    this._include = [];
    this._select = [];
    this._limit = -1; // negative limit means, do not send a limit
    this._skip = 0;
    this._defaultParams = {};
  };

  /**
   * Constructs a AV.Query that is the OR of the passed in queries.  For
   * example:
   * &lt;pre>var compoundQuery = AV.Query.or(query1, query2, query3);&lt;/pre>
   *
   * will create a compoundQuery that is an or of the query1, query2, and
   * query3.
   * @param {...AV.Query} var_args The list of queries to OR.
   * @return {AV.Query} The query that is the OR of the passed in queries.
   */
  AV.Query.or = function() {
    var queries = _.toArray(arguments);
    var className = null;
    AV._arrayEach(queries, function(q) {
      if (_.isNull(className)) {
        className = q.className;
      }

      if (className !== q.className) {
        throw new Error('All queries must be for the same class');
      }
    });
    var query = new AV.Query(className);
    query._orQuery(queries);
    return query;
  };

  /**
   * Constructs a AV.Query that is the AND of the passed in queries.  For
   * example:
   * &lt;pre>var compoundQuery = AV.Query.and(query1, query2, query3);&lt;/pre>
   *
   * will create a compoundQuery that is an 'and' of the query1, query2, and
   * query3.
   * @param {...AV.Query} var_args The list of queries to AND.
   * @return {AV.Query} The query that is the AND of the passed in queries.
   */
  AV.Query.and = function() {
    var queries = _.toArray(arguments);
    var className = null;
    AV._arrayEach(queries, function(q) {
      if (_.isNull(className)) {
        className = q.className;
      }

      if (className !== q.className) {
        throw new Error('All queries must be for the same class');
      }
    });
    var query = new AV.Query(className);
    query._andQuery(queries);
    return query;
  };

  /**
   * Retrieves a list of AVObjects that satisfy the CQL.
   * CQL syntax please see {@link https://leancloud.cn/docs/cql_guide.html CQL Guide}.
   *
   * @param {String} cql A CQL string, see {@link https://leancloud.cn/docs/cql_guide.html CQL Guide}.
   * @param {Array} pvalues An array contains placeholder values.
   * @param {AuthOptions} options
   * @return {Promise} A promise that is resolved with the results when
   * the query completes.
   */
  AV.Query.doCloudQuery = function(cql, pvalues, options) {
    var params = { cql: cql };
    if (_.isArray(pvalues)) {
      params.pvalues = pvalues;
    } else {
      options = pvalues;
    }

    var request = _request('cloudQuery', null, null, 'GET', params, options);
    return request.then(function(response) {
      //query to process results.
      var query = new AV.Query(response.className);
      var results = _.map(response.results, function(json) {
        var obj = query._newObject(response);
        if (obj._finishFetch) {
          obj._finishFetch(query._processResult(json), true);
        }
        return obj;
      });
      return {
        results: results,
        count: response.count,
        className: response.className,
      };
    });
  };

  /**
   * Return a query with conditions from json.
   * This can be useful to send a query from server side to client side.
   * @since 4.0.0
   * @param {Object} json from {@link AV.Query#toJSON}
   * @return {AV.Query}
   */
  AV.Query.fromJSON = ({
    className,
    where,
    include,
    select,
    includeACL,
    limit,
    skip,
    order,
  }) => {
    if (typeof className !== 'string') {
      throw new TypeError('Invalid Query JSON, className must be a String.');
    }
    const query = new AV.Query(className);
    _.extend(query, {
      _where: where,
      _include: include,
      _select: select,
      _includeACL: includeACL,
      _limit: limit,
      _skip: skip,
      _order: order,
    });
    return query;
  };

  AV.Query._extend = AV._extend;

  _.extend(
    AV.Query.prototype,
    /** @lends AV.Query.prototype */ {
      //hook to iterate result. Added by dennis&lt;xzhuang@avoscloud.com>.
      _processResult: function(obj) {
        return obj;
      },

      /**
       * Constructs an AV.Object whose id is already known by fetching data from
       * the server.
       *
       * @param {String} objectId The id of the object to be fetched.
       * @param {AuthOptions} options
       * @return {Promise.&lt;AV.Object>}
       */
      get: function(objectId, options) {
        if (!_.isString(objectId)) {
          throw new Error('objectId must be a string');
        }
        if (objectId === '') {
          return Promise.reject(
            new AVError(AVError.OBJECT_NOT_FOUND, 'Object not found.')
          );
        }

        var obj = this._newObject();
        obj.id = objectId;

        var queryJSON = this._getParams();
        var fetchOptions = {};

        if (queryJSON.keys) fetchOptions.keys = queryJSON.keys;
        if (queryJSON.include) fetchOptions.include = queryJSON.include;
        if (queryJSON.includeACL)
          fetchOptions.includeACL = queryJSON.includeACL;

        return _request(
          'classes',
          this.className,
          objectId,
          'GET',
          transformFetchOptions(fetchOptions),
          options
        ).then(response => {
          if (_.isEmpty(response))
            throw new AVError(AVError.OBJECT_NOT_FOUND, 'Object not found.');
          obj._finishFetch(obj.parse(response), true);
          return obj;
        });
      },

      /**
       * Returns a JSON representation of this query.
       * @return {Object}
       */
      toJSON() {
        const {
          className,
          _where: where,
          _include: include,
          _select: select,
          _includeACL: includeACL,
          _limit: limit,
          _skip: skip,
          _order: order,
        } = this;
        return {
          className,
          where,
          include,
          select,
          includeACL,
          limit,
          skip,
          order,
        };
      },

      _getParams: function() {
        var params = _.extend({}, this._defaultParams, {
          where: this._where,
        });

        if (this._include.length > 0) {
          params.include = this._include.join(',');
        }
        if (this._select.length > 0) {
          params.keys = this._select.join(',');
        }
        if (this._includeACL !== undefined) {
          params.returnACL = this._includeACL;
        }
        if (this._limit >= 0) {
          params.limit = this._limit;
        }
        if (this._skip > 0) {
          params.skip = this._skip;
        }
        if (this._order !== undefined) {
          params.order = this._order;
        }

        return params;
      },

      _newObject: function(response) {
        var obj;
        if (response &amp;&amp; response.className) {
          obj = new AV.Object(response.className);
        } else {
          obj = new this.objectClass();
        }
        return obj;
      },
      _createRequest(
        params = this._getParams(),
        options,
        path = `/classes/${this.className}`
      ) {
        if (encodeURIComponent(JSON.stringify(params)).length > 2000) {
          const body = {
            requests: [
              {
                method: 'GET',
                path: `/1.1${path}`,
                params,
              },
            ],
          };
          return request({
            path: '/batch',
            method: 'POST',
            data: body,
            authOptions: options,
          }).then(response => {
            const result = response[0];
            if (result.success) {
              return result.success;
            }
            const error = new AVError(
              result.error.code,
              result.error.error || 'Unknown batch error'
            );
            throw error;
          });
        }
        return request({
          method: 'GET',
          path,
          query: params,
          authOptions: options,
        });
      },

      _parseResponse(response) {
        return _.map(response.results, json => {
          var obj = this._newObject(response);
          if (obj._finishFetch) {
            obj._finishFetch(this._processResult(json), true);
          }
          return obj;
        });
      },

      /**
       * Retrieves a list of AVObjects that satisfy this query.
       *
       * @param {AuthOptions} options
       * @return {Promise} A promise that is resolved with the results when
       * the query completes.
       */
      find(options) {
        const request = this._createRequest(undefined, options);
        return request.then(this._parseResponse.bind(this));
      },

      /**
       * Retrieves both AVObjects and total count.
       *
       * @since 4.12.0
       * @param {AuthOptions} options
       * @return {Promise} A tuple contains results and count.
       */
      findAndCount(options) {
        const params = this._getParams();
        params.count = 1;
        const request = this._createRequest(params, options);

        return request.then(response => [
          this._parseResponse(response),
          response.count,
        ]);
      },

      /**
       * scan a Query. masterKey required.
       *
       * @since 2.1.0
       * @param {object} [options]
       * @param {string} [options.orderedBy] specify the key to sort
       * @param {number} [options.batchSize] specify the batch size for each request
       * @param {AuthOptions} [authOptions]
       * @return {AsyncIterator.&lt;AV.Object>}
       * @example const testIterator = {
       *   [Symbol.asyncIterator]() {
       *     return new Query('Test').scan(undefined, { useMasterKey: true });
       *   },
       * };
       * for await (const test of testIterator) {
       *   console.log(test.id);
       * }
       */
      scan({ orderedBy, batchSize } = {}, authOptions) {
        const condition = this._getParams();
        debug('scan %O', condition);
        if (condition.order) {
          console.warn(
            'The order of the query is ignored for Query#scan. Checkout the orderedBy option of Query#scan.'
          );
          delete condition.order;
        }
        if (condition.skip) {
          console.warn(
            'The skip option of the query is ignored for Query#scan.'
          );
          delete condition.skip;
        }
        if (condition.limit) {
          console.warn(
            'The limit option of the query is ignored for Query#scan.'
          );
          delete condition.limit;
        }
        if (orderedBy) condition.scan_key = orderedBy;
        if (batchSize) condition.limit = batchSize;
        let cursor;
        let remainResults = [];
        return {
          next: () => {
            if (remainResults.length) {
              return Promise.resolve({
                done: false,
                value: remainResults.shift(),
              });
            }
            if (cursor === null) {
              return Promise.resolve({ done: true });
            }
            return _request(
              'scan/classes',
              this.className,
              null,
              'GET',
              cursor ? _.extend({}, condition, { cursor }) : condition,
              authOptions
            ).then(response => {
              cursor = response.cursor;
              if (response.results.length) {
                const results = this._parseResponse(response);
                results.forEach(result => remainResults.push(result));
              }
              if (cursor === null &amp;&amp; remainResults.length === 0) {
                return { done: true };
              }
              return {
                done: false,
                value: remainResults.shift(),
              };
            });
          },
        };
      },

      /**
       * Delete objects retrieved by this query.
       * @param {AuthOptions} options
       * @return {Promise} A promise that is fulfilled when the save
       *     completes.
       */
      destroyAll: function(options) {
        var self = this;
        return self.find(options).then(function(objects) {
          return AV.Object.destroyAll(objects, options);
        });
      },

      /**
       * Counts the number of objects that match this query.
       *
       * @param {AuthOptions} options
       * @return {Promise} A promise that is resolved with the count when
       * the query completes.
       */
      count: function(options) {
        var params = this._getParams();
        params.limit = 0;
        params.count = 1;
        var request = this._createRequest(params, options);

        return request.then(function(response) {
          return response.count;
        });
      },

      /**
       * Retrieves at most one AV.Object that satisfies this query.
       *
       * @param {AuthOptions} options
       * @return {Promise} A promise that is resolved with the object when
       * the query completes.
       */
      first: function(options) {
        var self = this;

        var params = this._getParams();
        params.limit = 1;
        var request = this._createRequest(params, options);

        return request.then(function(response) {
          return _.map(response.results, function(json) {
            var obj = self._newObject();
            if (obj._finishFetch) {
              obj._finishFetch(self._processResult(json), true);
            }
            return obj;
          })[0];
        });
      },

      /**
       * Sets the number of results to skip before returning any results.
       * This is useful for pagination.
       * Default is to skip zero results.
       * @param {Number} n the number of results to skip.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      skip: function(n) {
        requires(n, 'undefined is not a valid skip value');
        this._skip = n;
        return this;
      },

      /**
       * Sets the limit of the number of results to return. The default limit is
       * 100, with a maximum of 1000 results being returned at a time.
       * @param {Number} n the number of results to limit to.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      limit: function(n) {
        requires(n, 'undefined is not a valid limit value');
        this._limit = n;
        return this;
      },

      /**
       * Add a constraint to the query that requires a particular key's value to
       * be equal to the provided value.
       * @param {String} key The key to check.
       * @param value The value that the AV.Object must contain.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      equalTo: function(key, value) {
        requires(key, 'undefined is not a valid key');
        requires(value, 'undefined is not a valid value');
        this._where[key] = AV._encode(value);
        return this;
      },

      /**
       * Helper for condition queries
       * @private
       */
      _addCondition: function(key, condition, value) {
        requires(key, 'undefined is not a valid condition key');
        requires(condition, 'undefined is not a valid condition');
        requires(value, 'undefined is not a valid condition value');

        // Check if we already have a condition
        if (!this._where[key]) {
          this._where[key] = {};
        }
        this._where[key][condition] = AV._encode(value);
        return this;
      },

      /**
       * Add a constraint to the query that requires a particular
       * &lt;strong>array&lt;/strong> key's length to be equal to the provided value.
       * @param {String} key The array key to check.
       * @param {number} value The length value.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      sizeEqualTo: function(key, value) {
        this._addCondition(key, '$size', value);
        return this;
      },

      /**
       * Add a constraint to the query that requires a particular key's value to
       * be not equal to the provided value.
       * @param {String} key The key to check.
       * @param value The value that must not be equalled.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      notEqualTo: function(key, value) {
        this._addCondition(key, '$ne', value);
        return this;
      },

      /**
       * Add a constraint to the query that requires a particular key's value to
       * be less than the provided value.
       * @param {String} key The key to check.
       * @param value The value that provides an upper bound.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      lessThan: function(key, value) {
        this._addCondition(key, '$lt', value);
        return this;
      },

      /**
       * Add a constraint to the query that requires a particular key's value to
       * be greater than the provided value.
       * @param {String} key The key to check.
       * @param value The value that provides an lower bound.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      greaterThan: function(key, value) {
        this._addCondition(key, '$gt', value);
        return this;
      },

      /**
       * Add a constraint to the query that requires a particular key's value to
       * be less than or equal to the provided value.
       * @param {String} key The key to check.
       * @param value The value that provides an upper bound.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      lessThanOrEqualTo: function(key, value) {
        this._addCondition(key, '$lte', value);
        return this;
      },

      /**
       * Add a constraint to the query that requires a particular key's value to
       * be greater than or equal to the provided value.
       * @param {String} key The key to check.
       * @param value The value that provides an lower bound.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      greaterThanOrEqualTo: function(key, value) {
        this._addCondition(key, '$gte', value);
        return this;
      },

      /**
       * Add a constraint to the query that requires a particular key's value to
       * be contained in the provided list of values.
       * @param {String} key The key to check.
       * @param {Array} values The values that will match.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      containedIn: function(key, values) {
        this._addCondition(key, '$in', values);
        return this;
      },

      /**
       * Add a constraint to the query that requires a particular key's value to
       * not be contained in the provided list of values.
       * @param {String} key The key to check.
       * @param {Array} values The values that will not match.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      notContainedIn: function(key, values) {
        this._addCondition(key, '$nin', values);
        return this;
      },

      /**
       * Add a constraint to the query that requires a particular key's value to
       * contain each one of the provided list of values.
       * @param {String} key The key to check.  This key's value must be an array.
       * @param {Array} values The values that will match.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      containsAll: function(key, values) {
        this._addCondition(key, '$all', values);
        return this;
      },

      /**
       * Add a constraint for finding objects that contain the given key.
       * @param {String} key The key that should exist.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      exists: function(key) {
        this._addCondition(key, '$exists', true);
        return this;
      },

      /**
       * Add a constraint for finding objects that do not contain a given key.
       * @param {String} key The key that should not exist
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      doesNotExist: function(key) {
        this._addCondition(key, '$exists', false);
        return this;
      },

      /**
       * Add a regular expression constraint for finding string values that match
       * the provided regular expression.
       * This may be slow for large datasets.
       * @param {String} key The key that the string to match is stored in.
       * @param {RegExp} regex The regular expression pattern to match.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      matches: function(key, regex, modifiers) {
        this._addCondition(key, '$regex', regex);
        if (!modifiers) {
          modifiers = '';
        }
        // Javascript regex options support mig as inline options but store them
        // as properties of the object. We support mi &amp; should migrate them to
        // modifiers
        if (regex.ignoreCase) {
          modifiers += 'i';
        }
        if (regex.multiline) {
          modifiers += 'm';
        }

        if (modifiers &amp;&amp; modifiers.length) {
          this._addCondition(key, '$options', modifiers);
        }
        return this;
      },

      /**
       * Add a constraint that requires that a key's value matches a AV.Query
       * constraint.
       * @param {String} key The key that the contains the object to match the
       *                     query.
       * @param {AV.Query} query The query that should match.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      matchesQuery: function(key, query) {
        var queryJSON = query._getParams();
        queryJSON.className = query.className;
        this._addCondition(key, '$inQuery', queryJSON);
        return this;
      },

      /**
       * Add a constraint that requires that a key's value not matches a
       * AV.Query constraint.
       * @param {String} key The key that the contains the object to match the
       *                     query.
       * @param {AV.Query} query The query that should not match.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      doesNotMatchQuery: function(key, query) {
        var queryJSON = query._getParams();
        queryJSON.className = query.className;
        this._addCondition(key, '$notInQuery', queryJSON);
        return this;
      },

      /**
       * Add a constraint that requires that a key's value matches a value in
       * an object returned by a different AV.Query.
       * @param {String} key The key that contains the value that is being
       *                     matched.
       * @param {String} queryKey The key in the objects returned by the query to
       *                          match against.
       * @param {AV.Query} query The query to run.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      matchesKeyInQuery: function(key, queryKey, query) {
        var queryJSON = query._getParams();
        queryJSON.className = query.className;
        this._addCondition(key, '$select', { key: queryKey, query: queryJSON });
        return this;
      },

      /**
       * Add a constraint that requires that a key's value not match a value in
       * an object returned by a different AV.Query.
       * @param {String} key The key that contains the value that is being
       *                     excluded.
       * @param {String} queryKey The key in the objects returned by the query to
       *                          match against.
       * @param {AV.Query} query The query to run.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      doesNotMatchKeyInQuery: function(key, queryKey, query) {
        var queryJSON = query._getParams();
        queryJSON.className = query.className;
        this._addCondition(key, '$dontSelect', {
          key: queryKey,
          query: queryJSON,
        });
        return this;
      },

      /**
       * Add constraint that at least one of the passed in queries matches.
       * @param {Array} queries
       * @return {AV.Query} Returns the query, so you can chain this call.
       * @private
       */
      _orQuery: function(queries) {
        var queryJSON = _.map(queries, function(q) {
          return q._getParams().where;
        });

        this._where.$or = queryJSON;
        return this;
      },

      /**
       * Add constraint that both of the passed in queries matches.
       * @param {Array} queries
       * @return {AV.Query} Returns the query, so you can chain this call.
       * @private
       */
      _andQuery: function(queries) {
        var queryJSON = _.map(queries, function(q) {
          return q._getParams().where;
        });

        this._where.$and = queryJSON;
        return this;
      },

      /**
       * Converts a string into a regex that matches it.
       * Surrounding with \Q .. \E does this, we just need to escape \E's in
       * the text separately.
       * @private
       */
      _quote: function(s) {
        return '\\Q' + s.replace('\\E', '\\E\\\\E\\Q') + '\\E';
      },

      /**
       * Add a constraint for finding string values that contain a provided
       * string.  This may be slow for large datasets.
       * @param {String} key The key that the string to match is stored in.
       * @param {String} substring The substring that the value must contain.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      contains: function(key, value) {
        this._addCondition(key, '$regex', this._quote(value));
        return this;
      },

      /**
       * Add a constraint for finding string values that start with a provided
       * string.  This query will use the backend index, so it will be fast even
       * for large datasets.
       * @param {String} key The key that the string to match is stored in.
       * @param {String} prefix The substring that the value must start with.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      startsWith: function(key, value) {
        this._addCondition(key, '$regex', '^' + this._quote(value));
        return this;
      },

      /**
       * Add a constraint for finding string values that end with a provided
       * string.  This will be slow for large datasets.
       * @param {String} key The key that the string to match is stored in.
       * @param {String} suffix The substring that the value must end with.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      endsWith: function(key, value) {
        this._addCondition(key, '$regex', this._quote(value) + '$');
        return this;
      },

      /**
       * Sorts the results in ascending order by the given key.
       *
       * @param {String} key The key to order by.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      ascending: function(key) {
        requires(key, 'undefined is not a valid key');
        this._order = key;
        return this;
      },

      /**
       * Also sorts the results in ascending order by the given key. The previous sort keys have
       * precedence over this key.
       *
       * @param {String} key The key to order by
       * @return {AV.Query} Returns the query so you can chain this call.
       */
      addAscending: function(key) {
        requires(key, 'undefined is not a valid key');
        if (this._order) this._order += ',' + key;
        else this._order = key;
        return this;
      },

      /**
       * Sorts the results in descending order by the given key.
       *
       * @param {String} key The key to order by.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      descending: function(key) {
        requires(key, 'undefined is not a valid key');
        this._order = '-' + key;
        return this;
      },

      /**
       * Also sorts the results in descending order by the given key. The previous sort keys have
       * precedence over this key.
       *
       * @param {String} key The key to order by
       * @return {AV.Query} Returns the query so you can chain this call.
       */
      addDescending: function(key) {
        requires(key, 'undefined is not a valid key');
        if (this._order) this._order += ',-' + key;
        else this._order = '-' + key;
        return this;
      },

      /**
       * Add a proximity based constraint for finding objects with key point
       * values near the point given.
       * @param {String} key The key that the AV.GeoPoint is stored in.
       * @param {AV.GeoPoint} point The reference AV.GeoPoint that is used.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      near: function(key, point) {
        if (!(point instanceof AV.GeoPoint)) {
          // Try to cast it to a GeoPoint, so that near("loc", [20,30]) works.
          point = new AV.GeoPoint(point);
        }
        this._addCondition(key, '$nearSphere', point);
        return this;
      },

      /**
       * Add a proximity based constraint for finding objects with key point
       * values near the point given and within the maximum distance given.
       * @param {String} key The key that the AV.GeoPoint is stored in.
       * @param {AV.GeoPoint} point The reference AV.GeoPoint that is used.
       * @param maxDistance Maximum distance (in radians) of results to return.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      withinRadians: function(key, point, distance) {
        this.near(key, point);
        this._addCondition(key, '$maxDistance', distance);
        return this;
      },

      /**
       * Add a proximity based constraint for finding objects with key point
       * values near the point given and within the maximum distance given.
       * Radius of earth used is 3958.8 miles.
       * @param {String} key The key that the AV.GeoPoint is stored in.
       * @param {AV.GeoPoint} point The reference AV.GeoPoint that is used.
       * @param {Number} maxDistance Maximum distance (in miles) of results to
       *     return.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      withinMiles: function(key, point, distance) {
        return this.withinRadians(key, point, distance / 3958.8);
      },

      /**
       * Add a proximity based constraint for finding objects with key point
       * values near the point given and within the maximum distance given.
       * Radius of earth used is 6371.0 kilometers.
       * @param {String} key The key that the AV.GeoPoint is stored in.
       * @param {AV.GeoPoint} point The reference AV.GeoPoint that is used.
       * @param {Number} maxDistance Maximum distance (in kilometers) of results
       *     to return.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      withinKilometers: function(key, point, distance) {
        return this.withinRadians(key, point, distance / 6371.0);
      },

      /**
       * Add a constraint to the query that requires a particular key's
       * coordinates be contained within a given rectangular geographic bounding
       * box.
       * @param {String} key The key to be constrained.
       * @param {AV.GeoPoint} southwest
       *     The lower-left inclusive corner of the box.
       * @param {AV.GeoPoint} northeast
       *     The upper-right inclusive corner of the box.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      withinGeoBox: function(key, southwest, northeast) {
        if (!(southwest instanceof AV.GeoPoint)) {
          southwest = new AV.GeoPoint(southwest);
        }
        if (!(northeast instanceof AV.GeoPoint)) {
          northeast = new AV.GeoPoint(northeast);
        }
        this._addCondition(key, '$within', { $box: [southwest, northeast] });
        return this;
      },

      /**
       * Include nested AV.Objects for the provided key.  You can use dot
       * notation to specify which fields in the included object are also fetch.
       * @param {String[]} keys The name of the key to include.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      include: function(keys) {
        requires(keys, 'undefined is not a valid key');
        _.forEach(arguments, keys => {
          this._include = this._include.concat(ensureArray(keys));
        });
        return this;
      },

      /**
       * Include the ACL.
       * @param {Boolean} [value=true] Whether to include the ACL
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      includeACL: function(value = true) {
        this._includeACL = value;
        return this;
      },

      /**
       * Restrict the fields of the returned AV.Objects to include only the
       * provided keys.  If this is called multiple times, then all of the keys
       * specified in each of the calls will be included.
       * @param {String[]} keys The names of the keys to include.
       * @return {AV.Query} Returns the query, so you can chain this call.
       */
      select: function(keys) {
        requires(keys, 'undefined is not a valid key');
        _.forEach(arguments, keys => {
          this._select = this._select.concat(ensureArray(keys));
        });
        return this;
      },

      /**
       * Iterates over each result of a query, calling a callback for each one. If
       * the callback returns a promise, the iteration will not continue until
       * that promise has been fulfilled. If the callback returns a rejected
       * promise, then iteration will stop with that error. The items are
       * processed in an unspecified order. The query may not have any sort order,
       * and may not use limit or skip.
       * @param callback {Function} Callback that will be called with each result
       *     of the query.
       * @return {Promise} A promise that will be fulfilled once the
       *     iteration has completed.
       */
      each: function(callback, options = {}) {
        if (this._order || this._skip || this._limit >= 0) {
          var error = new Error(
            'Cannot iterate on a query with sort, skip, or limit.'
          );
          return Promise.reject(error);
        }

        var query = new AV.Query(this.objectClass);
        // We can override the batch size from the options.
        // This is undocumented, but useful for testing.
        query._limit = options.batchSize || 100;
        query._where = _.clone(this._where);
        query._include = _.clone(this._include);

        query.ascending('objectId');

        var finished = false;
        return continueWhile(
          function() {
            return !finished;
          },
          function() {
            return query.find(options).then(function(results) {
              var callbacksDone = Promise.resolve();
              _.each(results, function(result) {
                callbacksDone = callbacksDone.then(function() {
                  return callback(result);
                });
              });

              return callbacksDone.then(function() {
                if (results.length >= query._limit) {
                  query.greaterThan('objectId', results[results.length - 1].id);
                } else {
                  finished = true;
                }
              });
            });
          }
        );
      },

      /**
       * Subscribe the changes of this query.
       *
       * LiveQuery is not included in the default bundle: {@link https://url.leanapp.cn/enable-live-query}.
       *
       * @since 3.0.0
       * @return {AV.LiveQuery} An eventemitter which can be used to get LiveQuery updates;
       */
      subscribe(options) {
        return AV.LiveQuery.init(this, options);
      },
    }
  );

  AV.FriendShipQuery = AV.Query._extend({
    _newObject: function() {
      const UserClass = AV.Object._getSubclass('_User');
      return new UserClass();
    },
    _processResult: function(json) {
      if (json &amp;&amp; json[this._friendshipTag]) {
        var user = json[this._friendshipTag];
        if (user.__type === 'Pointer' &amp;&amp; user.className === '_User') {
          delete user.__type;
          delete user.className;
        }
        return user;
      } else {
        return null;
      }
    },
  });
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Thu Jul 04 2024 10:32:11 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
